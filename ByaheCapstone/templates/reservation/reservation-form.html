{% extends "reservation/reserve-layout.html" %}
{% load static %}

{% block title %}
    Book Your Travel | Byahe Travel
{% endblock title %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Byahe Online Travel Reservation</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    {% block style %}
    <link rel="stylesheet" href="{% static '/styles/reservation-styles.css' %}">
    {% endblock style%}
</head>

    {% block navbar %}
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand logo" href="#">
                <img src="{% static '/images/backgrounds/byahe-logo.png' %}" alt="Logo" class="navbar-logo">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto d-flex align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" href="#about-us">About Us</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#book-your-ride">Services</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#vehicles-section">Vehicles</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#ratings-and-reviews">Reviews</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contacts">Contact</a>
                    </li>
                
                    <li class="nav-item">
                        <!-- Existing Get Started Button -->
                        <a href="{% url 'reservation_form' %}" class="btn get-started-btn ms-3 book-now-btn">Book Now</a>
                    </li>
                </ul>
                <!-- User Icon with Dropdown -->
                <ul class="navbar-nav ms-1 d-flex align-items-center">
                    <li class="nav-item dropdown">
                        <a class="nav-link d-flex align-items-center dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user-circle" style="font-size: 2.3rem; margin-right: 0.5rem;"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end animate__animated animate__fadeIn animate__faster" aria-labelledby="userDropdown">
                            <li>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-user" style="margin-right: 0.5rem;"></i>User Profile
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'logout' %}">
                                    <i class="fas fa-sign-out-alt" style="margin-right: 0.5rem; color: red;"></i>Log Out
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    {% endblock navbar %}

    {% block hero_section %}
    <!-- Hero Section for Reservation Form -->
    <section class="reservation-hero" style="
    color: white;
    min-height: 50vh;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 80px 40px;
    margin-top: 40px;
    text-align: left;
    background-image: url('{% static 'images/backgrounds/vehicle-bg.jpg' %}');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    position: relative;
    ">
        <div class="container text-center">
        <h1 class="display-4">Reservation Form</h1>
        <p class="lead">Fill up your reservation form to get your travel started.</p>
        </div>
    </section>
    {% endblock hero_section %}

    {% block reservation_form %}
    <div class="container my-5">
        <div class="card shadow-lg p-4">
            <div class="card-body">
                <h2 class="card-title text-center mb-4">Byahe Reservation Form</h2>
    
                <form id="reservationForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="fullName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="fullName" placeholder="Enter full name">
                        </div>
                        <div class="col-md-6">
                            <label for="contactNumber" class="form-label">Contact Number</label>
                            <input type="text" class="form-control" id="contactNumber" placeholder="Enter contact number">
                        </div>
                    </div>
    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="pickupDate" class="form-label">Pickup Date (mm/dd/yyyy)</label>
                            <input type="date" class="form-control" id="pickupDate">
                        </div>
                        <div class="col-md-6">
                            <label for="dropoffDate" class="form-label">Dropoff Date (mm/dd/yyyy)</label>
                            <input type="date" class="form-control" id="dropoffDate">
                        </div>
                    </div>
    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="pickupTime" class="form-label">Pickup Time</label>
                            <input type="time" class="form-control" id="pickupTime">
                        </div>
                        <div class="col-md-6">
                            <label for="dropoffTime" class="form-label">Dropoff Time</label>
                            <input type="time" class="form-control" id="dropoffTime">
                        </div>
                    </div>
    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="pickupLocation" class="form-label">Pickup Location (Starting Point)</label>
                            <input type="text" class="form-control" id="pickupLocation" placeholder="Enter starting point">
                        </div>
                        <div class="col-md-6">
                            <label for="dropoffLocation" class="form-label">Dropoff Location (End Point)</label>
                            <input type="text" class="form-control" id="dropoffLocation" placeholder="Enter end point">
                        </div>
                    </div>
    
                    <!-- Google Maps -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <div id="map" style="height: 300px; width: 100%;"></div>
                        </div>
                    </div>
    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="vehicle" class="form-label">Vehicle</label>
                            <select class="form-control" id="vehicle">
                                <option value="">Select a vehicle</option>
                                <option value="Toyota Corolla">Toyota Corolla</option>
                                <option value="Modernized PUV V1">Modernized PUV V1</option>
                                <option value="Modernized PUV V2">Modernized PUV V2</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="paymentMethod" class="form-label">Select Payment Method</label>
                            <select class="form-control" id="paymentMethod">
                                <option value="">Select Payment Method</option>
                                <option value="gcash">GCash</option>
                                <option value="cash">On-hand Payment (CASH)</option>
                            </select>
                        </div>
                    </div>
    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="totalFare" class="form-label">Total Fare</label>
                            <input class="form-control" type="text" id="totalFare" placeholder="" readonly>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="roundtrip">
                                <label class="form-check-label" for="roundtrip">Roundtrip</label>
                            </div>
                        </div>
                    </div>
    
                    <!-- File Upload Section (Hidden by Default) -->
                    <div class="mb-3" id="gcashSection" style="display: none;">
                        <label for="gcashReceipt" class="form-label">Upload GCash receipt</label>
                        <input type="file" class="form-control" id="gcashReceipt" accept="image/*" onchange="previewGcashReceipt(event)">
    
                        <div class="position-relative mt-3">
                            <img id="gcashPreview" src="#" alt="GCash Receipt Preview" class="img-fluid" style="display: none; max-width: 100%; height: auto;">
                            <button type="button" id="removePhoto" class="btn btn-danger position-absolute" aria-label="Remove" style="border-radius: 10px; height: 30px; width: 50px; top: 5px; right: 5px; display: none; padding: 5px;" onclick="removeGcashReceipt()">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
    
                        <p>Please upload your GCash payment receipt (Image file only).</p>
                    </div>
    
                    <button type="submit" class="btn btn-primary">Submit Reservation Form</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Google Maps API Script -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script>
    <script>
        let map;
        let geocoder;
        let markerPickup, markerDropoff;
    
        function initMap() {
            // Initialize map, centered on default location
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 14.599512, lng: 120.984222 }, // Default to Manila, Philippines
                zoom: 10,
            });
            geocoder = new google.maps.Geocoder();
    
            // Trigger geocoding when location input changes
            document.getElementById('pickupLocation').addEventListener('change', geocodePickup);
            document.getElementById('dropoffLocation').addEventListener('change', geocodeDropoff);
        }
    
        // Geocode pickup location
        function geocodePickup() {
            const address = document.getElementById('pickupLocation').value;
            geocoder.geocode({ 'address': address }, function (results, status) {
                if (status === 'OK') {
                    if (markerPickup) markerPickup.setMap(null); // Remove previous marker
                    map.setCenter(results[0].geometry.location);
                    markerPickup = new google.maps.Marker({
                        map: map,
                        position: results[0].geometry.location,
                        label: 'P'
                    });
                } else {
                    alert('Pickup location not found: ' + status);
                }
            });
        }
    
        // Geocode dropoff location
        function geocodeDropoff() {
            const address = document.getElementById('dropoffLocation').value;
            geocoder.geocode({ 'address': address }, function (results, status) {
                if (status === 'OK') {
                    if (markerDropoff) markerDropoff.setMap(null); // Remove previous marker
                    markerDropoff = new google.maps.Marker({
                        map: map,
                        position: results[0].geometry.location,
                        label: 'D'
                    });
                } else {
                    alert('Dropoff location not found: ' + status);
                }
            });
        }
    </script>
    
    <script>
        document.getElementById('paymentMethod').addEventListener('change', function () {
            const paymentMethod = this.value;
            const gcashSection = document.getElementById('gcashSection');
    
            // Show the GCash section if GCash is selected, hide otherwise
            if (paymentMethod === 'gcash') {
                gcashSection.style.display = 'block';
            } else {
                gcashSection.style.display = 'none';
                removeGcashReceipt(); // Clear the receipt if hidden
            }
        });
    
        function previewGcashReceipt(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('gcashPreview');
            const removeButton = document.getElementById('removePhoto');
    
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    removeButton.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }
    
        function removeGcashReceipt() {
            document.getElementById('gcashReceipt').value = ''; // Clears the file input
            document.getElementById('gcashPreview').style.display = 'none'; // Hides the image preview
            document.getElementById('removePhoto').style.display = 'none'; // Hides the remove button
        }
    </script>
    {% endblock reservation_form %}

    <footer id="contacts">
        <div class="container-fluid bg-primary text-white py-5">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <h2>Contact Us</h2>
                        <p>Have any questions or need assistance? Contact us today!</p>
                    </div>
                    <div class="col-md-6 contact-info">
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="fas fa-envelope mr-2"></i>
                                <a href="mailto:lucbangenesis@yahoo.com" class="text-white">lucbangenesis@yahoo.com</a>
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-phone mr-2"></i>
                                <span>0913 123 1234</span>
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-phone mr-2"></i>
                                <span>042 - 1234 - 123</span>
                            </li>
                            <li>
                                <i class="fas fa-map-marker-alt mr-2"></i>
                                <span>Gulang-Gulang, Lucena City, Quezon Province, Philippines</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container py-4">
            <div class="row">
                <div class="col-md-6">
                    <h5>BYAHE</h5>
                </div>
                <div class="col-md-6 text-right">
                    <ul class="list-inline">
                        <li class="list-inline-item"><a href="#">Home</a></li>
                        <li class="list-inline-item"><a href="#about-us">About</a></li>
                        <li class="list-inline-item"><a href="#vehicles-section">Vehicles</a></li>
                        <li class="list-inline-item"><a href="#reivews-and-ratings">Reviews</a></li>
                        <li class="list-inline-item"><a href="#book-your-ride">Services</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>


</html>
